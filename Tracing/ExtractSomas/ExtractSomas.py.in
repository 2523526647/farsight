#!/usr/bin/env python

import os
import os.path
import subprocess
import sys

scriptPath = os.path.dirname(sys.argv[0])
if scriptPath != "":
  os.chdir(scriptPath)

if len(sys.argv) < 3:
  print sys.argv[0] + " <input image> <output image>"
  sys.exit(1)

input = sys.argv[1]
output = sys.argv[2] 

subprocess.call(["./MedianImageFilter${CMAKE_EXECUTABLE_SUFFIX}", input, "median.tif"])
subprocess.call(["./RobustAutomaticThresholdImageFilterTest${CMAKE_EXECUTABLE_SUFFIX}", "median.tif", "robust.tif", "2", "2.0"])
subprocess.call(["./PadImage${CMAKE_EXECUTABLE_SUFFIX}", "robust.tif", "padded.tif"])
subprocess.call(["./HoleFillingFilterTest${CMAKE_EXECUTABLE_SUFFIX}", "padded.tif", "filled_padded.tif", "1000", "1"])
subprocess.call(["./ExtractImageFromPadding${CMAKE_EXECUTABLE_SUFFIX}", "filled_padded.tif", "filled.tif"])
subprocess.call(["./DistanceMapFilter${CMAKE_EXECUTABLE_SUFFIX}", "filled.tif", "distance.mhd"])
#somas get bigger as the last parameter to BinaryThresholdImageFilter gets smaller
subprocess.call(["./BinaryThresholdImageFilter${CMAKE_EXECUTABLE_SUFFIX}", "distance.mhd", "distanceThreshold.tif", "1.0"])
subprocess.call(["./PadImage${CMAKE_EXECUTABLE_SUFFIX}", "distanceThreshold.tif", "distanceThreshold_padded.tif"])
subprocess.call(["./PadDistanceMap${CMAKE_EXECUTABLE_SUFFIX}", "distance.mhd", "distance_padded.mhd"])
#last parameter of DownwardFrontPropagation should be expected radius of tubes
subprocess.call(["./DownwardFrontPropagation${CMAKE_EXECUTABLE_SUFFIX}", "distanceThreshold_padded.tif", "distance_padded.mhd","output_somas_padded.tif", "1000", "1.0"])
subprocess.call(["./ExtractImageFromPadding${CMAKE_EXECUTABLE_SUFFIX}", "output_somas_padded.tif", output])
subprocess.call(["./IsolateCentroids${CMAKE_EXECUTABLE_SUFFIX}", output])
subprocess.call(["./VoronoiFilter${CMAKE_EXECUTABLE_SUFFIX}", "centroids.tif", "voronoi.mhd"])
